{% extends 'base.html' %}
{% load crispy_forms_filters %}
    {% block content %}
        <div class="container mt-4">

            <div class="card mt-4 border-primary">
                <div class="card-header">
                    <span class="text-muted">Asked by: </span>
                    <a href="#" class="link">{{ question.asked_by.username }}</a>
                    <span class="text-muted"> On </span>
                    {{ question.asked_on }}
                </div>
                <div class="card-title nav-link mt-3">
                    {{ question.title }}
                </div>
                <div class="card-body" id="question">
                    {{ question.description|linebreaksbr }}
                </div>
            </div>

            <form method="post" class="mt-4">
                {% csrf_token %}
                <div class="form-group">
                    {{form|crispy}}
                </div>
                
                <div class="card mt-4 mb-4 border-secondary">
                    <div class="card-header">Output: </div>
                    <div id="target" class="card-body"></div>
                </div>

                <div class="form-group">
                    <button class="btn btn-block btn-outline-primary" type="submit">
                        Answer question
                    </button>
                </div>
            </form>
        </div>
        

        <!-- Showdown JS Config -->
        <script src="https://unpkg.com/showdown/dist/showdown.min.js"></script>
        <script defer>
            const converter = new showdown.Converter()
            const description_box = document.getElementById('id_text')
            const target = document.getElementById('target')
            const defaultText = "<span class=\"text-muted\">Start typing to see the output!</span>"

            const updateOutput = () => {
                const text = description_box.value
                if(text.trim() === ''){
                    target.innerHTML = defaultText
                    return null
                }
                html = converter.makeHtml(text)
                target.innerHTML = html
            }
            
            description_box.addEventListener('input', updateOutput)
            updateOutput()
            
            question = document.getElementById('question')
            question.innerHTML = converter.makeHtml(question.innerText)

        </script>

    {% endblock content %}